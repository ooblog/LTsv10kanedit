「LTsv_doc」は「LTsv10kanedit(tsvtool10)」を用いたドキュメント生成ツールです。
このモジュール解説文書「LTsv_doc.txt」も「LTsv_doc」を使って「LTsv_doc.tsv」から錬成されてます。
version(branch) 20161023U011852
modify 20161106U044140


目次

 ０-0． ライセンス及びソフトの使用の補足ガイドライン
 ０-1． インストール(ダウンロード・アンインストール)＆セットアップ
 ０-2． その他現在わかっている不具合や今後の課題
 １-0a．「L:Tsv」「tsvtool」と「LTSV」の違い
 １-0b．「L:Tsv」ファイルの構造
 １-1a．「LTsv_printf.py」の関数一覧
 １-1a．「LTsv_kanare()」のLTsv_recaseの変換辞書一覧
 １-2． 「LTsv_file.py」の関数一覧

０-0． ライセンス及びソフトの使用の補足ガイドライン

 ※「MIT License」準拠。
   MIT License - Choose a License
   http://choosealicense.com/licenses/mit/

 ※「MIT License」の日本語訳。
   MIT License - Choose a License
   https://osdn.jp/projects/opensource/wiki/licenses%2FMIT_license

 ※日本語による補足。
   ・複製物にも「MIT License」の[LICENSE]ファイルを添付る事(著作権表示を誤魔化さない事)。
   ・いかなる場合においても作者または著作権所有者は一切責任を負わない事。
   ・ソースコードの閲覧やコピーに制限を設けない事。

 ※「kanedit」固有の問題への言及。
   ・単漢字辞書「LTsv/kanchar.tsv」汎用辞書「kanword.tsv」などで翻訳ミスもしくは言い回しが古くなるなど人間語不具合に対してもメンテナンス義務はありません。


０-1． インストール(ダウンロード・アンインストール)＆セットアップ

 ダウンロードは「https://github.com/ooblog/LTsv10kanedit」にある「Clone or download」ボタンを押すと出る「Download ZIP」メニューをクリック。
 インストールは任意(なるだけユーザーディレクトリ内)のフォルダに「LTsv10kanedit-master.zip」を解凍するだけです。
 「kan5x5comic.ttf」を用意する場合は「kan5x5.svg」から「FontForge」で変換するか「kan5x5comic.woff」を「WOFFコンバーター」変換(「kanfont.txt」を参考)。
 Wineを使う予定がある場合は「wine_sh」フォルダ内の[*.sh]のWineパスを適宜修正。
 ※Pythonは別途インストールされているものとします(Pythonの導入分からない人は「<@index3-0>」も参考)。


０-2． その他現在わかっている不具合や今後の課題

 Python 2.7.6(Tahrpup6.0.5)およびPython3.4.4(Wine1.7.18)で開発しています。Windows,cygwin,darwinなどでの動作は確認しておりません。
 フォント「kan5x5comic」は半角と全角の幅の比率が約5:3(1024:624)なのでアスキーアートで問題になる場合があります。グリフ不足で表示できない文字などあります。
 「kanpickle.bin」にグリフ座標データが蓄積されるまでは動作が重いです。「kanmap.py」で解決できます。
 「kan5x5.svg」を「kan5x5comic.ttf」に変換する手段として「FontForge」が必要。直接フォント生成したいけど優先順位が低い。
 現在人名に使える漢字の異体字を漢字配列「kanmap.tsv」から単漢字辞書「kanchar,tsv」に移管作業中。なので漢字鍵盤の漢字配列が大幅に変更するかも。
 Windowsのエディタで[kanchar.tsv]を編集すると3バイト以上の文字が「?」に置き換えられる恐れがある。カレー()がよく巻き添え
 マウスボタンの取得は保留。ホイールの取得は放置。tkk方面は手を出さない予定(コンボボックスなどはGTKのみサポート)。
 GTKのコールバックからデータを受けとる方法が不明のため、GUIイベント経由のPCキーボード取得やファイルダイアログからのキャンセル取得などが不明。
 ドキュメント全体でグリフとフォントの言葉の使い分けルールが曖昧な気がする。


１-0a．「L:Tsv」「tsvtool」と「LTSV」の違い

 データ間の区切りをタブ(\t)、「label:data」の様にコロン(:)でデータにラベルを付けたのが「LTSV」です。
 素のLTSVファイル自体は単なるログのフォーマットです。

   Labeled Tab-separated Values (LTSV)
   http://ltsv.org/


  LTSV FAQ - LTSV って何? どういうところが良いの?
  http://d.hatena.ne.jp/naoya/20130209/1360381374

 「L:Tsv」は「*.tsv」「*.ltsv」ファイルの事を差す場合もありますがLTSVパーサ類を含めた「tsvtool」も含めて「L:Tsv」と呼ぶ場合があります。
 複数のLTSVを１つのファイルで保存できるようタグで区切ったり、日時処理や分数電卓やGTK＆Tkinterなどを加えたり、Python2,3のprint関数バージョン違いを吸収させたりと、
 LTSVパーサに雑多な拡張を重ねていった結果、漢直エディタ環境と化したモジュール群が今の「L:Tsv」です。


１-0b．「L:Tsv」ファイルの構造

 データ間の区切りはタブ(\t)です。一般的なCSVやLTSV等と事なり、複数のタブがあっても1つのタブとみなします(文字列長0のデータを扱う場合はラベル推奨)。
 先頭データの事をfirst、先頭以降のデータの事をrestと呼びます。例えばLispでも、car関数の代わりにfirst関数、cdr関数の代わりにrest関数が使えたはず。
 firstは縦軸ラベルとして使う場合があります。restでは「label:data」の様なラベルとデータをコロン(:)で区切る形の軸ラベルが付けられます。簡単に言うとrestでLTSVが使えます。
 LTSVを「[tag|」と「|tag]」の様にタグで挟む事で１つのファイルに複数のCSVやLTSVやTXT等複数のページを格納できます。
 拡張子は「.ltsv」か「.tsv」。メモリ上など拡張子で区別できない場合でもメタタグで判定。メタタグが存在しない場合ファイル全体を１つのページとみなす。

 メタタグ「L:Tsv」のfirst縦軸ラベルの解説。
  [L:Tsv|                    「L:Tsv」ファイルの宣言です。マジックナンバー代わりなのでなるだけファイルの先頭に。
   code                       文字コードの宣言で「UTF-8」。Windowsだろうが半角は3バイトで保存するので注意。
   enter                      改行の宣言で「LF」。Windowsだろうが改行は1バイトで保存するので注意。
   tab                        タブインデントの宣言で半角スペース「4」。フォント「kan5x5comic」の半角と全角の幅の比率は約5:3(1024:624)なので注意。
   program                    「L:Tsv」ファイルをどの様に扱うかを表す規格名(プログラム名)を記述。例えば「LTsv_doc」では「LTsv_doc.py」。
   1st                        「L:Tsv」自体を何かのスクリプトとして実行する場合に最初に実行するページ指定を想定。例えば「LTsv_doc」では「LTsv_doc_tsv」など。
   LTsvver                    構文解析パーサのバージョン。「LTsv_file.py」の「LTsv_file_ver()」。
   modify                     「L:Tsv」ファイルの更新日時。「LTsv_time.py」の「LTsv_getdaytimestr(overhour=24,diffminute=0)」を想定。「LTsv_file.py」で「LTsv_savefile()」上書き時に更新。

「L:Tsv」のメタタグは「LTsv_newfile()」関数でも作成可能。「１-2． 「LTsv_file.py」の関数一覧」も参考。


１-1a．「LTsv_printf.py」の関数一覧

 Pythonのprint関数の代わりにlibcのprintfを呼び出すモジュールです。
 ・Wine上DOSのエラー要因だったCP932(いわゆるシフトJIS、BMP基本多言語面0xffff範囲内)などに変換させる事で漢字をある程度(BMP基本多言語面0xffff範囲内)扱えるようになります。
 ・変換できない文字は数値文字参照に変換されます。
 ・その他数値文字参照(文字参照含む)の変換、全角半角大文字小文字ひらがなカタカナの変換などが扱えます。
 ・単体風テストでは仮名変換「LTsv_kanare()」など関数群の挙動確認などができます。

  【LTsv_libc_printf(LTsv_text,LTsv_log=None)】
  LTsv_textの文字列をターミナル(stdout)に表示する。LTsv_logに変数名を指定する事で変数にも出力追記できる。
  LTsv_textに渡す文字列は「"{0}".format(data)」みたいに事前に「str.format()」などで加工する。
  扱えない文字は数値文字参照(「咖喱」が「&#21654;&#21937;」)に変換される。
  「ctypes.cdll.msvcrt(MS-DOS)」は1024バイト(文字数ではなくバイト)を超える文字列を扱えない様子。

  【LTsv_libc_printcat(LTsv_text)】
  上記LTsv_libc_printfからログ保存やL:Tsvタグエスケープ処理などを取り除いたもの。

  【LTsv_libc_printf_type(LTsv_text)】
  Python2の「<type 'str'>」Python3の「「<class 'bytes'>」のようにprintfに渡すバイナリ文字列の変数の型を表示。

  【LTsv_utf2xml(LTsv_text)】
  LTsv_textの文字列を数値文字参照に変換。

  【LTsv_xml2utf(LTsv_text)】
  LTsv_textの文字参照(数値文字参照含む)を文字列に変換。

  【LTsv_kanare(LTsv_before,LTsv_recase)】
  全角半角大文字小文字ひらがなカタカナの変換を行います。LTsv_beforeに変換する文字列、LTsv_recaseで変換辞書指定。
  変換辞書LTsv_recaseのパラメータは「１-1a．「LTsv_kanare()」のLTsv_recaseの変換辞書一覧」を参考。

  【LTsv_utf2ink(LTsv_text)】
  UTF-8をkantrayの「UTF-8点字」に変換(バイナリの点字表記)。
  点字フォントが表示できる環境にないと動作確認は困難なので注意。

  【LTsv_ink2utf(LTsv_text)】
  上記「UTF-8点字」をUTF-8に戻す。
   データ破損を補完する機能はないので注意。

  【LTsv_subprocess(LTsv_subprocess_input="",LTsv_subprocess_shell=False)】
  ターミナルにコマンドを送る。実行結果も取得できる。
  「LTsv_subprocess_shell=True」でより複雑な事もできるようになるが、インジェクション脆弱性の恐れが発生するので注意。



１-1a．「LTsv_kanare()」のLTsv_recaseの変換辞書一覧

   "Hira2Kata"         ひらがなをカタカナに。
   "Kata2Hira"         カタカナをひらがなに。
   "HiraKana2SeiH"     濁音を清音に。「ぱぴぷぺぽ」と「ぱぴぷぺぽ」は「はひふへほ」に。
   "HiraKana2SeiM"     濁音を清音に。「ばびぶべぼ」は「はひふへほ」に、「ぱぴぷぺぽ」を「まみむめも」に。
   "HiraKana2DakB"     清音を濁音に。「はひふへほ」は「ばびぶべぼ」に。
   "HiraKana2DakP"     清音を濁音に。「はひふへほ」は「ばびぶべぼ」に、「まみむめも」を「ぱぴぷぺぽ」に。
   "HiraKana2Han"      ひらがなもカタカナも半角に。
   "HiraKana2HanKaKe"  ひらがなもカタカナも「ヵヶ」も半角に。
   "Han2HiraEz"        半角をひらがなに(濁音は分離したまま)。
   "Han2KataEz"        半角をカタカナに(濁音は分離したまま)。
   "Han2Hira"          半角をひらがなに(濁音があっても１つの文字に統合)。
   "Han2Kata"          半角をカタカナに(濁音があっても１つの文字に統合)。
   "Alpha2BIG"         半角全角にかかわらずアルファベットを大文字に(キリル文字ギリシャ文字含む)。
   "Alpha2SML"         半角全角にかかわらずアルファベットを小文字に(キリル文字ギリシャ文字含む)。
   "Alpha2HAN"         大文字小文字にかかわらずアルファベットを半角に(キリル文字ギリシャ文字含まない)。
   "Alpha2ZENBS"       大文字小文字にかかわらずアルファベットを全角に(キリル文字ギリシャ文字含まない)。バックスラッシュは「＼」へ。
   "Alpha2ZENYen"      大文字小文字にかかわらずアルファベットを全角に(キリル文字ギリシャ文字含まない)。バックスラッシュは「￥」へ。


１-2． 「LTsv_file.py」の関数一覧

 Pythonのprint関数の代わりにlibcのprintfを呼び出すモジュールです。
 ・Wine上DOSのエラー要因だったCP932(いわゆるシフトJIS、BMP基本多言語面0xffff範囲内)に変換させる事で(変換できない文字は数値文字参照)漢字をある程度扱えるようになります。
 ・その他数値文字参照(文字参照含む)の変換、全角半角大文字小文字ひらがなカタカナの変換などが扱えます。
 ・単体風テストでは仮名変換「LTsv_kanare()」など関数群の挙動確認などができます。

  【LTsv_newfile(LTsv_program,LTsv_default=None)】
  「L:Tsv」ファイルを変数上に作成する。
   LTsv_programには「L:Tsv」ファイルを扱うプログラムまたは規格を記述。
  LTsv_defaultには「L:Tsv」ファイル自体をスクリプトとして実行する場合の1stページの指定。
  メタタグについては「<@index1-0b>」も参考。

  【LTsv_download(LTsv_url,LTsv_path,LTsv_reporthook=None)】
  ネット上のLTsv_urlにあるファイルをローカルのLTsv_pathに保存する。
  ダウンロード中にLTsv_reporthook(count,blocksize,totalsize)をコールバックして状況報告させる事は可能(スレッド関係の扱いに注意)。

  【LTsv_zipload(LTsv_zip,LTsv_name,LTsv_path)】
  ローカル上のLTsv_zipにあるファイルをローカルのLTsv_pathに解凍する。

  【LTsv_loadfile(LTsv_path,LTsv_encoding="utf-8",LTsv_default=None)】
  ローカル上のLTsv_pathから「L:Tsv」ファイルを読み込む。
  LTsv_encodingにテキストのコード指定。例えばCP932(いわゆるシフトJIS、BMP基本多言語面0xffff範囲内)を読み込むときは「LTsv_encoding="cp932"」が必要。
  LTsv_defaultは読み込みできなかった場合の初期値を指定。

  【LTsv_readlinepages(LTsv_text)】
  LTsv_textテキスト内のタグ「[tag|」一覧を1行のLTSVとして取得する。

  【LTsv_getpage(LTsv_text,LTsv_tag,LTsv_default=None)】
  タグ「[LTsv_tag|」「|LTsv_tag]」で囲まれた範囲のLTSVページを取得。
  LTsv_default(LTsv_page)はページを取得できなかった場合の初期値を指定。

  【LTsv_readlinedeno(LTsv_text)】
  LTSVページの行数を数える。LTsv_textに改行が無くても1行とみなす。
  LTsv_textの文字列長が0の場合0を返す。

  【LTsv_readlinenum(LTsv_text,LTsv_linenum,LTsv_default=None)】
  0から数えた行数でLTSVページから1行読み込む。
  LTsv_default(LTsv_line)は読み込めなかった場合の初期値を指定。

  【LTsv_readlinefirsts(LTsv_text)】
  LTSVページのfirst(縦軸ラベル)一覧を1行のLTSVとして取得。

  【LTsv_readlinerest(LTsv_text,LTsv_first,LTsv_default=None)】
  LTSVページからfirst(縦軸ラベル)指定で先頭以下データrestを1行読み込む。first(縦軸ラベル)の取得にはタブ文字が必要。
  LTsv_default(LTsv_rest)はrestが読み込めなかった場合の初期値を指定。

  【LTsv_pickdatadeno(LTsv_line)】
  1行のLTSVに含まれるデータ個数を取得(firstも0個目のデータとみなす)。
  「label:data」をラベルとデータに分ける場合は「LTsv_split_label_data()」などを併用する。

  【LTsv_pickdatanum(LTsv_line,LTsv_datanum,LTsv_default=None)】
  1行のLTSVから0から数えた項目数指定で1個読み込む(firstも0個目のデータとみなす)。
  「label:data」をラベルとデータに分ける場合は「LTsv_split_label_data()」などを併用する。

  【LTsv_split_label_data(LTsv_labeldata,LTsv_seldata=True)】
  「label:data」からlabelかdataのどちらかを取得。LTsv_seldataがTrueならdata部分を、Falseならlabel部分を返す。

  【LTsv_pickdatas(LTsv_line,LTsv_dataL=0,LTsv_dataR=0)】
  1行のLTSVから0から数えた項目数指定で範囲内の複数データを読み込む(firstも0個目のデータとみなす)。いわゆるスライス操作。
  LTsv_dataLとLTsv_dataRが逆(Tsv_dataRの方が小さい)の場合でも関数内で自動的に並び替える。
  LTsv_dataLとLTsv_dataRが同じ場合差分が無いので読み込まない。

  【LTsv_pickdatafind(LTsv_line,LTsv_find)】
  LTsv_findが1行のLTSVの何項目にデータがあるか0から数える(firstも0個目のデータとみなす)。

  【LTsv_joindatanum(LTsv_line,LTsv_datanum,LTsv_default=None)】
  1行のLTSVのLTsv_datanum項目目にLTsv_default(LTsv_data)を追加する。
  LTsv_datanumが0以下の場合先頭firstに追加。項目数以上の場合末尾に追加。
  省略もしくは文字列長0の場合は何もしない。

  【LTsv_setdatanum(LTsv_line,LTsv_datanum,LTsv_default=None)】
  1行のLTSVのLTsv_datanum項目目にデータLTsv_default(LTsv_data)を上書する。
  負数の場合や項目数以上の場合は何もしない。
   LTsv_default(LTsv_data)を省略もしくは文字列長0のデータの場合は項目を削除。

  【LTsv_pickdatalabel(LTsv_line,LTsv_label,LTsv_default=None)】
  1行のLTSVから「label:data」形式の横軸ラベル(LTsv_label)指定で1個読み込む。
  LTsv_default(LTsv_data)は読み込みできなかった場合の初期値を指定。

  【LTsv_pickdic(LTsv_text,LTsv_first,LTsv_label)】
  「LTsv_readlinerest()」と「LTsv_pickdatalabel()」をひとまとめに。単漢字辞書「LTsv/kanchar.tsv」読込用途。
  first(縦軸ラベル)で指定行、restの横軸ラベル(LTsv_label)で指定列、データ1個を読み込む。

  【LTsv_setdatalabel(LTsv_line,LTsv_label,LTsv_default=None)】
  1行のLTSVの「label:data」形式横軸ベル(LTsv_label)項指定でデータLTsv_default(LTsv_data)を上書する。
  元LTSVに存在しない横軸ラベル(LTsv_label)の場合末尾に追加。
  LTsv_default(LTsv_data)を省略した場合に項目はラベルごと削除。
  文字列長0のデータLTsv_default(LTsv_data)であっても省略しなかった場合は横軸ラベル項目を追加もしくは上書き。
  上記LTsv_joindatanumやLTsv_setdatanumと事なりLTsv_setdatalabelでは「label:」が単独で存在(文字列0の「data」が存在できる)違いがあるので注意。

  【LTsv_sievelabels(LTsv_rest,LTsv_labels="")】
  データそのままにラベルを取り替える。
  文字列0の「data」(データ数よりラベル数が多い場合を想定)は項目が消えるので注意。

  【LTsv_sievetuplelabels(LTsv_rest,*LTsv_labels)】
  「LTsv_sievelabels()」とほぼ同じだが、LTsv_labelがLTSVではなくタプル。

  【LTsv_pushlinenum(LTsv_text,LTsv_linenum,LTsv_default=None)】
  LTSVページに0から数えた行数指定で1行LTsv_default(LTsv_line)を追加する。
  1行追加想定だけど複数行のテキスト挿入も可能。
  LTsv_default(LTsv_line)を省略もしくは文字列長0のデータの場合は何もしない。

  【LTsv_overlinenum(LTsv_text,LTsv_linenum,LTsv_default=None)】
  LTSVページに0から数えた行数指定で1行LTsv_default(LTsv_line)を上書する。
  1行上書想定だけど複数行のテキスト挿入も可能。
  LTsv_default(LTsv_line)を省略もしくは文字列長0のデータの場合は1行削除。

  【LTsv_pushlinerest(LTsv_page,LTsv_first,LTsv_default=None)】
  

  【LTsv_putpage(LTsv_text,LTsv_tag,LTsv_default=None)】
  

  【LTsv_putmodify(LTsv_text)】
  

  【LTsv_savedir(LTsv_path)】
  

  【LTsv_savedirs(LTsv_path)】
  

  【LTsv_savefile(LTsv_path,LTsv_default=None)】
  

  【LTsv_saveplain(LTsv_path,LTsv_plain)】
  

  【LTsv_labelzip(LTsv_labels,LTsv_datas)】
  

  【LTsv_unziplabel(LTsv_line)】
  

  【LTsv_unzipdata(LTsv_line)】
  

  【LTsv_unziplabelsdata(LTsv_line,LTsv_labels)】
  

  【LTsv_unziptuplelabelsdata(LTsv_line,*LTsv_labels)】
  

  【LTsv_tuple2tsv(LTsv_tuple)】
  

  【LTsv_tsv2list(LTsv_line,LTsv_len=None)】
  

  【LTsv_tsv2tuple(LTsv_line,LTsv_count=None)】
  

  【LTsv_intstr0x(LTsv_codestr)】
  

  【LTsv_label2dictint(LTsv_line)】
  

  【LTsv_label2dictstr(LTsv_line)】
  

  【LTsv_dict2label(LTsv_dict)】
  

  【LTsv_file_ver()】
  

  【LTsv_issue()】
  



# Copyright (c) 2016 ooblog
# License: MIT
# https://github.com/ooblog/LTsv10kanedit/blob/master/LICENSE

